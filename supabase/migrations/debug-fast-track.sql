-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ” DIAGNÃ“STICO: Fast Track Router - Por que nÃ£o estÃ¡ executando?
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- IMPORTANTE: Substitua 'SEU_CLIENT_ID_AQUI' pelo seu client_id real

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- 1ï¸âƒ£ VERIFICAR NÃVEL 1: Node habilitado no Flow Architecture?
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT
  'NÃVEL 1: Node Enabled no Flow' as check_type,
  CASE
    WHEN EXISTS (
      SELECT 1 FROM bot_configurations
      WHERE client_id = 'SEU_CLIENT_ID_AQUI'
      AND config_key = 'flow:node_enabled:fast_track_router'
      AND config_value->>'enabled' = 'true'
    ) THEN 'âœ… HABILITADO'
    WHEN EXISTS (
      SELECT 1 FROM bot_configurations
      WHERE client_id = 'SEU_CLIENT_ID_AQUI'
      AND config_key = 'flow:node_enabled:fast_track_router'
      AND config_value->>'enabled' = 'false'
    ) THEN 'âŒ DESABILITADO (problema aqui!)'
    ELSE 'âš ï¸ NÃƒO CONFIGURADO (usa default: false)'
  END as status,
  config_value
FROM bot_configurations
WHERE client_id = 'SEU_CLIENT_ID_AQUI'
  AND config_key = 'flow:node_enabled:fast_track_router';

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- 2ï¸âƒ£ VERIFICAR NÃVEL 2: Fast Track habilitado na config?
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT
  'NÃVEL 2: Fast Track Enabled' as check_type,
  CASE
    WHEN EXISTS (
      SELECT 1 FROM bot_configurations
      WHERE client_id = 'SEU_CLIENT_ID_AQUI'
      AND config_key = 'fast_track:enabled'
      AND config_value = 'true'::jsonb
    ) THEN 'âœ… HABILITADO'
    WHEN EXISTS (
      SELECT 1 FROM bot_configurations
      WHERE client_id = 'SEU_CLIENT_ID_AQUI'
      AND config_key = 'fast_track:enabled'
      AND config_value = 'false'::jsonb
    ) THEN 'âŒ DESABILITADO (problema aqui!)'
    ELSE 'âš ï¸ NÃƒO CONFIGURADO (usa default: false)'
  END as status,
  config_value
FROM bot_configurations
WHERE client_id = 'SEU_CLIENT_ID_AQUI'
  AND config_key = 'fast_track:enabled';

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- 3ï¸âƒ£ VERIFICAR CATÃLOGO: Tem FAQs cadastradas?
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT
  'NÃVEL 3: CatÃ¡logo de FAQs' as check_type,
  CASE
    WHEN config_value IS NULL THEN 'âŒ SEM CATÃLOGO (problema aqui!)'
    WHEN jsonb_array_length(config_value) = 0 THEN 'âŒ CATÃLOGO VAZIO (problema aqui!)'
    ELSE 'âœ… ' || jsonb_array_length(config_value)::text || ' FAQs cadastradas'
  END as status,
  config_value
FROM bot_configurations
WHERE client_id = 'SEU_CLIENT_ID_AQUI'
  AND config_key = 'fast_track:catalog';

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- 4ï¸âƒ£ VER TODAS AS CONFIGS DO FAST TRACK
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
SELECT
  config_key,
  config_value,
  created_at,
  updated_at
FROM bot_configurations
WHERE client_id = 'SEU_CLIENT_ID_AQUI'
  AND (
    config_key LIKE 'fast_track:%'
    OR config_key = 'flow:node_enabled:fast_track_router'
  )
ORDER BY config_key;

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- ğŸ”§ SOLUÃ‡ÃƒO: Habilitar Fast Track (execute SE necessÃ¡rio)
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 1: Habilitar NÃVEL 1 (Node no Flow)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSERT INTO bot_configurations (client_id, config_key, config_value)
VALUES (
  'SEU_CLIENT_ID_AQUI',
  'flow:node_enabled:fast_track_router',
  '{"enabled": true}'::jsonb
)
ON CONFLICT (client_id, config_key)
DO UPDATE SET
  config_value = '{"enabled": true}'::jsonb,
  updated_at = NOW();

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 2: Habilitar NÃVEL 2 (Fast Track Config)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSERT INTO bot_configurations (client_id, config_key, config_value)
VALUES (
  'SEU_CLIENT_ID_AQUI',
  'fast_track:enabled',
  'true'::jsonb
)
ON CONFLICT (client_id, config_key)
DO UPDATE SET
  config_value = 'true'::jsonb,
  updated_at = NOW();

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 3: Configurar Router Model (OBRIGATÃ“RIO)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSERT INTO bot_configurations (client_id, config_key, config_value)
VALUES (
  'SEU_CLIENT_ID_AQUI',
  'fast_track:router_model',
  '"gpt-4o-mini"'::jsonb  -- Modelo para classificaÃ§Ã£o
)
ON CONFLICT (client_id, config_key)
DO UPDATE SET
  config_value = '"gpt-4o-mini"'::jsonb,
  updated_at = NOW();

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 4: Configurar Threshold (Opcional - usa default 0.80)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSERT INTO bot_configurations (client_id, config_key, config_value)
VALUES (
  'SEU_CLIENT_ID_AQUI',
  'fast_track:similarity_threshold',
  '0.80'::jsonb
)
ON CONFLICT (client_id, config_key)
DO UPDATE SET
  config_value = '0.80'::jsonb,
  updated_at = NOW();

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 5: Adicionar CatÃ¡logo de FAQs (EXEMPLO)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
INSERT INTO bot_configurations (client_id, config_key, config_value)
VALUES (
  'SEU_CLIENT_ID_AQUI',
  'fast_track:catalog',
  '[
    {
      "topic": "faq_planos",
      "canonical": "Quais sÃ£o os planos disponÃ­veis?",
      "examples": [
        "pode me mandar o plano?",
        "quero ver os planos",
        "tem plano disponÃ­vel?",
        "quanto custa o plano?"
      ]
    },
    {
      "topic": "faq_horario",
      "canonical": "Qual Ã© o horÃ¡rio de funcionamento?",
      "examples": [
        "que horas vocÃªs abrem?",
        "horÃ¡rio de atendimento",
        "quando vocÃªs funcionam?",
        "atÃ© que horas atendem?"
      ]
    }
  ]'::jsonb
)
ON CONFLICT (client_id, config_key)
DO UPDATE SET
  config_value = '[
    {
      "topic": "faq_planos",
      "canonical": "Quais sÃ£o os planos disponÃ­veis?",
      "examples": [
        "pode me mandar o plano?",
        "quero ver os planos",
        "tem plano disponÃ­vel?",
        "quanto custa o plano?"
      ]
    },
    {
      "topic": "faq_horario",
      "canonical": "Qual Ã© o horÃ¡rio de funcionamento?",
      "examples": [
        "que horas vocÃªs abrem?",
        "horÃ¡rio de atendimento",
        "quando vocÃªs funcionam?",
        "atÃ© que horas atendem?"
      ]
    }
  ]'::jsonb,
  updated_at = NOW();

-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- SOLUÃ‡ÃƒO 6: Limpar Cache do Flow (Force Refresh)
-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
-- NÃ£o hÃ¡ comando SQL para isso - o cache Ã© em memÃ³ria no servidor
-- Reinicie o servidor Next.js ou aguarde 1 minuto (TTL do cache)

-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-- âœ… VERIFICAÃ‡ÃƒO FINAL
-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SELECT
  'RESUMO FINAL' as tipo,
  COUNT(*) FILTER (WHERE config_key LIKE 'fast_track:%') as configs_fast_track,
  COUNT(*) FILTER (WHERE config_key = 'flow:node_enabled:fast_track_router') as node_enabled_config,
  string_agg(config_key, ', ' ORDER BY config_key) as chaves_configuradas
FROM bot_configurations
WHERE client_id = 'SEU_CLIENT_ID_AQUI'
  AND (config_key LIKE 'fast_track:%' OR config_key = 'flow:node_enabled:fast_track_router');
